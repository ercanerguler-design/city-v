const { sql } = require('@vercel/postgres');
require('dotenv').config({ path: '.env.local' });

async function addDemoTransportData() {
  try {
    console.log('üöá Demo transport verilerini ekleniyor...');

    // ƒ∞stanbul - ƒ∞ETT ve Metro ƒ∞stanbul
    console.log('üèôÔ∏è ƒ∞stanbul transport verileri...');
    
    // ƒ∞ETT kurumu
    await sql`
      INSERT INTO transport_agencies (agency_name, agency_code, city_id, agency_type, website, primary_color) 
      VALUES ('ƒ∞ETT', 'IETT', 
        (SELECT id FROM turkey_cities WHERE city_code = 'IST'), 
        'municipal', 'https://iett.istanbul', '#E31E24')
      ON CONFLICT (agency_code) DO NOTHING
    `;

    // Metro ƒ∞stanbul
    await sql`
      INSERT INTO transport_agencies (agency_name, agency_code, city_id, agency_type, website, primary_color) 
      VALUES ('Metro ƒ∞stanbul', 'METRO_IST', 
        (SELECT id FROM turkey_cities WHERE city_code = 'IST'), 
        'municipal', 'https://metro.istanbul', '#0052CC')
      ON CONFLICT (agency_code) DO NOTHING
    `;

    // ƒ∞stanbul Metro Hatlarƒ±
    const istanbulMetroLines = [
      { code: 'M1A', name: 'Yenikapƒ± - Atat√ºrk Havalimanƒ±', type: 'metro', color: '#FF0000' },
      { code: 'M1B', name: 'Yenikapƒ± - Kirazlƒ±', type: 'metro', color: '#FF6600' },
      { code: 'M2', name: 'Veliefendi - Hacƒ±osman', type: 'metro', color: '#00AA44' },
      { code: 'M3', name: 'Olimpiyat - Ba≈üak≈üehir', type: 'metro', color: '#0066CC' },
      { code: 'M4', name: 'Kadƒ±k√∂y - Sabiha G√∂k√ßen', type: 'metro', color: '#FF1493' },
      { code: 'M5', name: '√úsk√ºdar - √áekmek√∂y', type: 'metro', color: '#800080' },
      { code: 'M6', name: 'Levent - Boƒüazi√ßi √úniversitesi', type: 'metro', color: '#8B4513' },
      { code: 'M7', name: 'Mecidiyek√∂y - Mahmutbey', type: 'metro', color: '#FF69B4' },
      { code: 'M8', name: 'Bostancƒ± - Parseller', type: 'metro', color: '#32CD32' },
      { code: 'M9', name: 'Atak√∂y - ƒ∞kitelli', type: 'metro', color: '#FFD700' }
    ];

    for (const line of istanbulMetroLines) {
      await sql`
        INSERT INTO transport_lines (line_code, line_name, line_type, city_id, agency_id, fare_price, frequency_minutes, vehicle_capacity, color_code) 
        SELECT ${line.code}, ${line.name}, ${line.type}, c.id, a.id, 15.00, 3, 500, ${line.color}
        FROM turkey_cities c, transport_agencies a 
        WHERE c.city_code = 'IST' AND a.agency_code = 'METRO_IST'
        ON CONFLICT DO NOTHING
      `;
    }

    // ƒ∞stanbul Otob√ºs Hatlarƒ±
    const istanbulBusLines = [
      { code: '15F', name: 'Emin√∂n√º - Baƒücƒ±lar', type: 'bus' },
      { code: '28', name: 'Edirnekapƒ± - Etiler', type: 'bus' },
      { code: '34', name: 'Avcƒ±lar - Mecidiyek√∂y', type: 'bus' },
      { code: '34AS', name: 'Avcƒ±lar - S√∂ƒü√ºtl√º√ße≈üme', type: 'bus' },
      { code: '500T', name: 'Taksim - Sarƒ±yer', type: 'bus' },
      { code: '16C', name: 'Cevizlibaƒü - Sarƒ±yer', type: 'bus' }
    ];

    for (const line of istanbulBusLines) {
      await sql`
        INSERT INTO transport_lines (line_code, line_name, line_type, city_id, agency_id, fare_price, frequency_minutes, vehicle_capacity, color_code) 
        SELECT ${line.code}, ${line.name}, ${line.type}, c.id, a.id, 15.00, 8, 120, '#E31E24'
        FROM turkey_cities c, transport_agencies a 
        WHERE c.city_code = 'IST' AND a.agency_code = 'IETT'
        ON CONFLICT DO NOTHING
      `;
    }

    // ƒ∞zmir - ESHOT
    console.log('üèôÔ∏è ƒ∞zmir transport verileri...');
    
    await sql`
      INSERT INTO transport_agencies (agency_name, agency_code, city_id, agency_type, website, primary_color) 
      VALUES ('ESHOT', 'ESHOT', 
        (SELECT id FROM turkey_cities WHERE city_code = 'IZM'), 
        'municipal', 'https://eshot.gov.tr', '#FF6600')
      ON CONFLICT (agency_code) DO NOTHING
    `;

    await sql`
      INSERT INTO transport_agencies (agency_name, agency_code, city_id, agency_type, website, primary_color) 
      VALUES ('ƒ∞zmir Metro A.≈û.', 'IZMIR_METRO', 
        (SELECT id FROM turkey_cities WHERE city_code = 'IZM'), 
        'municipal', 'https://izmirmetro.com.tr', '#0066CC')
      ON CONFLICT (agency_code) DO NOTHING
    `;

    // ƒ∞zmir Metro Hatlarƒ±
    const izmirMetroLines = [
      { code: 'M1', name: 'Fahrettin Altay - Evka 3', type: 'metro', color: '#FF0000' },
      { code: 'M2', name: 'Aliaƒüa - Menderes', type: 'metro', color: '#00AA44' }
    ];

    for (const line of izmirMetroLines) {
      await sql`
        INSERT INTO transport_lines (line_code, line_name, line_type, city_id, agency_id, fare_price, frequency_minutes, vehicle_capacity, color_code) 
        SELECT ${line.code}, ${line.name}, ${line.type}, c.id, a.id, 12.00, 5, 400, ${line.color}
        FROM turkey_cities c, transport_agencies a 
        WHERE c.city_code = 'IZM' AND a.agency_code = 'IZMIR_METRO'
        ON CONFLICT DO NOTHING
      `;
    }

    // ƒ∞zmir Otob√ºs Hatlarƒ±
    const izmirBusLines = [
      { code: '35', name: 'Alsancak - G√ºzelbah√ße', type: 'bus' },
      { code: '202', name: 'Konak - √ñdemi≈ü', type: 'bus' },
      { code: '754', name: 'Kar≈üƒ±yaka - Bornova', type: 'bus' },
      { code: '851', name: 'Alsancak - √áiƒüli', type: 'bus' }
    ];

    for (const line of izmirBusLines) {
      await sql`
        INSERT INTO transport_lines (line_code, line_name, line_type, city_id, agency_id, fare_price, frequency_minutes, vehicle_capacity, color_code) 
        SELECT ${line.code}, ${line.name}, ${line.type}, c.id, a.id, 7.00, 12, 90, '#FF6600'
        FROM turkey_cities c, transport_agencies a 
        WHERE c.city_code = 'IZM' AND a.agency_code = 'ESHOT'
        ON CONFLICT DO NOTHING
      `;
    }

    // Bursa - Burula≈ü
    console.log('üèôÔ∏è Bursa transport verileri...');
    
    await sql`
      INSERT INTO transport_agencies (agency_name, agency_code, city_id, agency_type, website, primary_color) 
      VALUES ('Burula≈ü', 'BURULAS', 
        (SELECT id FROM turkey_cities WHERE city_code = 'BUR'), 
        'municipal', 'https://burulas.com.tr', '#006633')
      ON CONFLICT (agency_code) DO NOTHING
    `;

    const bursaLines = [
      { code: 'BursaRay', name: 'Emek - Kestel', type: 'metro', color: '#0066CC' },
      { code: '1/A', name: 'Otogar - Setba≈üƒ±', type: 'bus', color: '#006633' },
      { code: '1/C', name: 'Otogar - G√∂r√ºkle', type: 'bus', color: '#006633' },
      { code: '2', name: '≈ûehrek√ºst√º - Mudanya', type: 'bus', color: '#006633' }
    ];

    for (const line of bursaLines) {
      await sql`
        INSERT INTO transport_lines (line_code, line_name, line_type, city_id, agency_id, fare_price, frequency_minutes, vehicle_capacity, color_code) 
        SELECT ${line.code}, ${line.name}, ${line.type}, c.id, a.id, 6.50, 10, 
          ${line.type === 'metro' ? 300 : 90}, ${line.color}
        FROM turkey_cities c, transport_agencies a 
        WHERE c.city_code = 'BUR' AND a.agency_code = 'BURULAS'
        ON CONFLICT DO NOTHING
      `;
    }

    // Antalya - ATAK
    console.log('üèôÔ∏è Antalya transport verileri...');
    
    await sql`
      INSERT INTO transport_agencies (agency_name, agency_code, city_id, agency_type, website, primary_color) 
      VALUES ('ATAK', 'ATAK', 
        (SELECT id FROM turkey_cities WHERE city_code = 'ANT'), 
        'municipal', 'https://atak.gov.tr', '#FF8800')
      ON CONFLICT (agency_code) DO NOTHING
    `;

    const antalyaLines = [
      { code: 'AntRay', name: 'Expo 2016 - Antalya Havalimanƒ±', type: 'tram', color: '#FF8800' },
      { code: '07', name: 'Konyaaltƒ± - Lara', type: 'bus', color: '#FF8800' },
      { code: '600', name: 'Otogar - Havalimanƒ±', type: 'bus', color: '#FF8800' },
      { code: '08', name: 'Kalei√ßi - Aksu', type: 'bus', color: '#FF8800' }
    ];

    for (const line of antalyaLines) {
      await sql`
        INSERT INTO transport_lines (line_code, line_name, line_type, city_id, agency_id, fare_price, frequency_minutes, vehicle_capacity, color_code) 
        SELECT ${line.code}, ${line.name}, ${line.type}, c.id, a.id, 5.00, 12, 
          ${line.type === 'tram' ? 200 : 80}, ${line.color}
        FROM turkey_cities c, transport_agencies a 
        WHERE c.city_code = 'ANT' AND a.agency_code = 'ATAK'
        ON CONFLICT DO NOTHING
      `;
    }

    // Adana - BUAS
    console.log('üèôÔ∏è Adana transport verileri...');
    
    await sql`
      INSERT INTO transport_agencies (agency_name, agency_code, city_id, agency_type, website, primary_color) 
      VALUES ('BUAS', 'BUAS', 
        (SELECT id FROM turkey_cities WHERE city_code = 'ADA'), 
        'municipal', 'https://buas.gov.tr', '#CC0000')
      ON CONFLICT (agency_code) DO NOTHING
    `;

    const adanaLines = [
      { code: 'M1', name: 'Adana Merkez - ≈ûakirpa≈üa', type: 'metro', color: '#CC0000' },
      { code: '101', name: 'Otogar - √áukurova √úniversitesi', type: 'bus', color: '#CC0000' },
      { code: '170', name: 'Seyhan - Sarƒ±√ßam', type: 'bus', color: '#CC0000' }
    ];

    for (const line of adanaLines) {
      await sql`
        INSERT INTO transport_lines (line_code, line_name, line_type, city_id, agency_id, fare_price, frequency_minutes, vehicle_capacity, color_code) 
        SELECT ${line.code}, ${line.name}, ${line.type}, c.id, a.id, 4.50, 8, 
          ${line.type === 'metro' ? 250 : 85}, ${line.color}
        FROM turkey_cities c, transport_agencies a 
        WHERE c.city_code = 'ADA' AND a.agency_code = 'BUAS'
        ON CONFLICT DO NOTHING
      `;
    }

    // Konya - KOTRA
    console.log('üèôÔ∏è Konya transport verileri...');
    
    await sql`
      INSERT INTO transport_agencies (agency_name, agency_code, city_id, agency_type, website, primary_color) 
      VALUES ('KOTRA', 'KOTRA', 
        (SELECT id FROM turkey_cities WHERE city_code = 'KON'), 
        'municipal', 'https://kotra.konya.bel.tr', '#00AA44')
      ON CONFLICT (agency_code) DO NOTHING
    `;

    const konyaLines = [
      { code: 'T1', name: 'Necmettin Erbakan √úniversitesi - Meram', type: 'tram', color: '#00AA44' },
      { code: '35', name: 'Terminal - Meram', type: 'bus', color: '#00AA44' },
      { code: '41', name: 'Sille - ≈ûeker Fabrikasƒ±', type: 'bus', color: '#00AA44' }
    ];

    for (const line of konyaLines) {
      await sql`
        INSERT INTO transport_lines (line_code, line_name, line_type, city_id, agency_id, fare_price, frequency_minutes, vehicle_capacity, color_code) 
        SELECT ${line.code}, ${line.name}, ${line.type}, c.id, a.id, 4.00, 10, 
          ${line.type === 'tram' ? 180 : 75}, ${line.color}
        FROM turkey_cities c, transport_agencies a 
        WHERE c.city_code = 'KON' AND a.agency_code = 'KOTRA'
        ON CONFLICT DO NOTHING
      `;
    }

    // Gaziantep - GAZIULA≈û
    console.log('üèôÔ∏è Gaziantep transport verileri...');
    
    await sql`
      INSERT INTO transport_agencies (agency_name, agency_code, city_id, agency_type, website, primary_color) 
      VALUES ('GAZIULA≈û', 'GAZIULAS', 
        (SELECT id FROM turkey_cities WHERE city_code = 'GAZ'), 
        'municipal', 'https://gaziantep.bel.tr', '#800080')
      ON CONFLICT (agency_code) DO NOTHING
    `;

    const gaziantepLines = [
      { code: '100', name: '≈ûahinbey - ƒ∞slahiye', type: 'bus', color: '#800080' },
      { code: '200', name: '≈ûehitkamil - Karata≈ü', type: 'bus', color: '#800080' },
      { code: '500', name: '√úniversite - Havalimanƒ±', type: 'bus', color: '#800080' }
    ];

    for (const line of gaziantepLines) {
      await sql`
        INSERT INTO transport_lines (line_code, line_name, line_type, city_id, agency_id, fare_price, frequency_minutes, vehicle_capacity, color_code) 
        SELECT ${line.code}, ${line.name}, ${line.type}, c.id, a.id, 4.00, 15, 80, ${line.color}
        FROM turkey_cities c, transport_agencies a 
        WHERE c.city_code = 'GAZ' AND a.agency_code = 'GAZIULAS'
        ON CONFLICT DO NOTHING
      `;
    }

    // ƒ∞statistikler
    const cityStats = await sql`
      SELECT 
        c.city_name,
        c.city_code,
        COUNT(tl.id) as line_count,
        COUNT(DISTINCT ta.id) as agency_count
      FROM turkey_cities c
      LEFT JOIN transport_lines tl ON c.id = tl.city_id
      LEFT JOIN transport_agencies ta ON c.id = ta.city_id
      WHERE c.transport_tier IN ('megapol', 'metropol', 'b√ºy√ºk')
      GROUP BY c.id, c.city_name, c.city_code
      ORDER BY line_count DESC
    `;

    console.log('\nüöå TRANSPORT ƒ∞STATƒ∞STƒ∞KLERƒ∞:');
    for (const stat of cityStats.rows) {
      if (stat.line_count > 0) {
        console.log(`   ${stat.city_name} (${stat.city_code}): ${stat.line_count} hat, ${stat.agency_count} kurum`);
      }
    }

    const totalLines = await sql`SELECT COUNT(*) as total FROM transport_lines`;
    const totalAgencies = await sql`SELECT COUNT(*) as total FROM transport_agencies`;
    
    console.log(`\nüéâ TOPLAM: ${totalLines.rows[0].total} hat, ${totalAgencies.rows[0].total} kurum`);
    console.log('‚úÖ Demo transport verileri ba≈üarƒ±yla eklendi!');

  } catch (error) {
    console.error('‚ùå Demo veri ekleme hatasƒ±:', error);
    process.exit(1);
  }
}

addDemoTransportData();